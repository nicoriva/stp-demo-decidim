{"ast":null,"code":"function _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\n/* eslint-disable require-jsdoc */\n\nimport lineBreakButtonHandler from \"src/decidim/editor/linebreak_module\";\nimport \"src/decidim/editor/clipboard_override\";\nimport \"src/decidim/vendor/image-resize.min\";\nimport \"src/decidim/vendor/image-upload.min\";\nvar quillFormats = [\"bold\", \"italic\", \"link\", \"underline\", \"header\", \"list\", \"alt\", \"break\", \"width\", \"style\", \"code\", \"blockquote\", \"indent\"];\nexport default function createQuillEditor(container) {\n  var toolbar = $(container).data(\"toolbar\");\n  var disabled = $(container).data(\"disabled\");\n  var allowedEmptyContentSelector = \"iframe\";\n  var quillToolbar = [[\"bold\", \"italic\", \"underline\", \"linebreak\"], [{\n    list: \"ordered\"\n  }, {\n    list: \"bullet\"\n  }], [\"link\", \"clean\"], [\"code\", \"blockquote\"], [{\n    indent: \"-1\"\n  }, {\n    indent: \"+1\"\n  }]];\n  var addImage = false;\n  var addVideo = false;\n\n  /**\n   * - basic = only basic controls without titles\n   * - content = basic + headings\n   * - full = basic + headings + image + video\n   */\n  if (toolbar === \"content\") {\n    quillToolbar = [[{\n      header: [2, 3, 4, 5, 6, false]\n    }]].concat(_toConsumableArray(quillToolbar));\n  } else if (toolbar === \"full\") {\n    addImage = true;\n    addVideo = true;\n    quillToolbar = [[{\n      header: [2, 3, 4, 5, 6, false]\n    }]].concat(_toConsumableArray(quillToolbar), [[\"video\"], [\"image\"]]);\n  }\n  var modules = {\n    linebreak: {},\n    toolbar: {\n      container: quillToolbar,\n      handlers: {\n        linebreak: lineBreakButtonHandler\n      }\n    }\n  };\n  var $input = $(container).siblings('input[type=\"hidden\"]');\n  container.innerHTML = $input.val() || \"\";\n  var token = $('meta[name=\"csrf-token\"]').attr(\"content\");\n  if (addVideo) {\n    quillFormats.push(\"video\");\n  }\n  if (addImage) {\n    // Attempt to allow images only if the image support is enabled at editor support.\n    // see: https://github.com/quilljs/quill/issues/1108\n    quillFormats.push(\"image\");\n    modules.imageResize = {\n      modules: [\"Resize\", \"DisplaySize\"]\n    };\n    modules.imageUpload = {\n      url: $(container).data(\"uploadImagesPath\"),\n      method: \"POST\",\n      name: \"image\",\n      withCredentials: false,\n      headers: {\n        \"X-CSRF-Token\": token\n      },\n      callbackOK: function callbackOK(serverResponse, next) {\n        $(\"div.ql-toolbar\").last().removeClass(\"editor-loading\");\n        next(serverResponse.url);\n      },\n      callbackKO: function callbackKO(serverError) {\n        $(\"div.ql-toolbar\").last().removeClass(\"editor-loading\");\n        console.log(\"Image upload error: \".concat(serverError.message));\n      },\n      checkBeforeSend: function checkBeforeSend(file, next) {\n        $(\"div.ql-toolbar\").last().addClass(\"editor-loading\");\n        next(file);\n      }\n    };\n    var text = $(container).data(\"dragAndDropHelpText\");\n    $(container).after(\"<p class=\\\"help-text\\\" style=\\\"margin-top:-1.5rem;\\\">\".concat(text, \"</p>\"));\n  }\n  var quill = new Quill(container, {\n    modules: modules,\n    formats: quillFormats,\n    theme: \"snow\"\n  });\n  if (addImage === false) {\n    // Firefox natively implements image drop in contenteditable which is why we need to disable that\n    quill.root.addEventListener(\"drop\", function (ev) {\n      return ev.preventDefault();\n    });\n  }\n  if (disabled) {\n    quill.disable();\n  }\n  quill.on(\"text-change\", function () {\n    var text = quill.getText();\n\n    // Triggers CustomEvent with the cursor position\n    // It is required in input_mentions.js\n    var event = new CustomEvent(\"quill-position\", {\n      detail: quill.getSelection()\n    });\n    container.dispatchEvent(event);\n    if ((text === \"\\n\" || text === \"\\n\\n\") && quill.root.querySelectorAll(allowedEmptyContentSelector).length === 0) {\n      $input.val(\"\");\n    } else {\n      var emptyParagraph = \"<p><br></p>\";\n      var cleanHTML = quill.root.innerHTML.replace(new RegExp(\"^\".concat(emptyParagraph, \"|\").concat(emptyParagraph, \"$\"), \"g\"), \"\");\n      $input.val(cleanHTML);\n    }\n  });\n  // After editor is ready, linebreak_module deletes two extraneous new lines\n  quill.emitter.emit(\"editor-ready\");\n  return quill;\n}","map":{"version":3,"names":["lineBreakButtonHandler","quillFormats","createQuillEditor","container","toolbar","$","data","disabled","allowedEmptyContentSelector","quillToolbar","list","indent","addImage","addVideo","header","concat","_toConsumableArray","modules","linebreak","handlers","$input","siblings","innerHTML","val","token","attr","push","imageResize","imageUpload","url","method","name","withCredentials","headers","callbackOK","serverResponse","next","last","removeClass","callbackKO","serverError","console","log","message","checkBeforeSend","file","addClass","text","after","quill","Quill","formats","theme","root","addEventListener","ev","preventDefault","disable","on","getText","event","CustomEvent","detail","getSelection","dispatchEvent","querySelectorAll","length","emptyParagraph","cleanHTML","replace","RegExp","emitter","emit"],"sources":["/home/nico/.rbenv/versions/3.0.2/lib/ruby/gems/3.0.0/gems/decidim-core-0.27.3/app/packs/src/decidim/editor.js"],"sourcesContent":["/* eslint-disable require-jsdoc */\n\nimport lineBreakButtonHandler from \"src/decidim/editor/linebreak_module\";\nimport \"src/decidim/editor/clipboard_override\";\nimport \"src/decidim/vendor/image-resize.min\";\nimport \"src/decidim/vendor/image-upload.min\";\n\nconst quillFormats = [\n  \"bold\",\n  \"italic\",\n  \"link\",\n  \"underline\",\n  \"header\",\n  \"list\",\n  \"alt\",\n  \"break\",\n  \"width\",\n  \"style\",\n  \"code\",\n  \"blockquote\",\n  \"indent\"\n];\n\nexport default function createQuillEditor(container) {\n  const toolbar = $(container).data(\"toolbar\");\n  const disabled = $(container).data(\"disabled\");\n\n  const allowedEmptyContentSelector = \"iframe\";\n  let quillToolbar = [\n    [\"bold\", \"italic\", \"underline\", \"linebreak\"],\n    [{ list: \"ordered\" }, { list: \"bullet\" }],\n    [\"link\", \"clean\"],\n    [\"code\", \"blockquote\"],\n    [{ indent: \"-1\" }, { indent: \"+1\" }]\n  ];\n\n  let addImage = false;\n  let addVideo = false;\n\n  /**\n   * - basic = only basic controls without titles\n   * - content = basic + headings\n   * - full = basic + headings + image + video\n   */\n  if (toolbar === \"content\") {\n    quillToolbar = [[{ header: [2, 3, 4, 5, 6, false] }], ...quillToolbar];\n  } else if (toolbar === \"full\") {\n    addImage = true;\n    addVideo = true;\n    quillToolbar = [\n      [{ header: [2, 3, 4, 5, 6, false] }],\n      ...quillToolbar,\n      [\"video\"],\n      [\"image\"]\n    ];\n  }\n\n  let modules = {\n    linebreak: {},\n    toolbar: {\n      container: quillToolbar,\n      handlers: {\n        linebreak: lineBreakButtonHandler\n      }\n    }\n  };\n  const $input = $(container).siblings('input[type=\"hidden\"]');\n  container.innerHTML = $input.val() || \"\";\n  const token = $('meta[name=\"csrf-token\"]').attr(\"content\");\n\n  if (addVideo) {\n    quillFormats.push(\"video\");\n  }\n\n  if (addImage) {\n    // Attempt to allow images only if the image support is enabled at editor support.\n    // see: https://github.com/quilljs/quill/issues/1108\n    quillFormats.push(\"image\");\n\n    modules.imageResize = {\n      modules: [\"Resize\", \"DisplaySize\"]\n    };\n    modules.imageUpload = {\n      url: $(container).data(\"uploadImagesPath\"),\n      method: \"POST\",\n      name: \"image\",\n      withCredentials: false,\n      headers: { \"X-CSRF-Token\": token },\n      callbackOK: (serverResponse, next) => {\n        $(\"div.ql-toolbar\").last().removeClass(\"editor-loading\");\n        next(serverResponse.url);\n      },\n      callbackKO: (serverError) => {\n        $(\"div.ql-toolbar\").last().removeClass(\"editor-loading\");\n        console.log(`Image upload error: ${serverError.message}`);\n      },\n      checkBeforeSend: (file, next) => {\n        $(\"div.ql-toolbar\").last().addClass(\"editor-loading\");\n        next(file);\n      }\n    };\n\n    const text = $(container).data(\"dragAndDropHelpText\");\n    $(container).after(\n      `<p class=\"help-text\" style=\"margin-top:-1.5rem;\">${text}</p>`\n    );\n  }\n  const quill = new Quill(container, {\n    modules: modules,\n    formats: quillFormats,\n    theme: \"snow\"\n  });\n\n  if (addImage === false) {\n    // Firefox natively implements image drop in contenteditable which is why we need to disable that\n    quill.root.addEventListener(\"drop\", (ev) => ev.preventDefault());\n  }\n\n  if (disabled) {\n    quill.disable();\n  }\n\n  quill.on(\"text-change\", () => {\n    const text = quill.getText();\n\n    // Triggers CustomEvent with the cursor position\n    // It is required in input_mentions.js\n    let event = new CustomEvent(\"quill-position\", {\n      detail: quill.getSelection()\n    });\n    container.dispatchEvent(event);\n\n    if (\n      (text === \"\\n\" || text === \"\\n\\n\") &&\n      quill.root.querySelectorAll(allowedEmptyContentSelector).length === 0\n    ) {\n      $input.val(\"\");\n    } else {\n      const emptyParagraph = \"<p><br></p>\";\n      const cleanHTML = quill.root.innerHTML.replace(\n        new RegExp(`^${emptyParagraph}|${emptyParagraph}$`, \"g\"),\n        \"\"\n      );\n      $input.val(cleanHTML);\n    }\n  });\n  // After editor is ready, linebreak_module deletes two extraneous new lines\n  quill.emitter.emit(\"editor-ready\");\n\n  return quill;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}