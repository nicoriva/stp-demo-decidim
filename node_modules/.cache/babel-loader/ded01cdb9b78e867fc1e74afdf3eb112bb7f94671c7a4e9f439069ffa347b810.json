{"ast":null,"code":"function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}\nfunction _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\nimport Cookies from \"js-cookie\";\nvar ConsentManager = /*#__PURE__*/function () {\n  // Options should contain the following keys:\n  // - modal - HTML element of the data consent modal (e.g. \"<div id=\"dc-modal\">Foo bar</div>\")\n  // - categories - Available data consent categories (e.g. [\"essential\", \"preferences\", \"analytics\", \"marketing\"])\n  // - cookieName - Name of the cookie saved in the browser (e.g. \"decidim-consent\")\n  // - warningElement - HTML element to be shown when user has not given the necessary data consent to display the content.\n  function ConsentManager(options) {\n    _classCallCheck(this, ConsentManager);\n    this.modal = options.modal;\n    this.categories = options.categories;\n    this.cookieName = options.cookieName;\n    this.cookie = Cookies.get(this.cookieName);\n    this.warningElement = options.warningElement;\n    if (this.cookie) {\n      this.updateState(JSON.parse(this.cookie));\n    } else {\n      this.updateState({});\n    }\n  }\n  _createClass(ConsentManager, [{\n    key: \"updateState\",\n    value: function updateState(newState) {\n      this.state = newState;\n      Cookies.set(this.cookieName, JSON.stringify(this.state), {\n        domain: document.location.host.split(\":\")[0],\n        sameSite: \"Lax\",\n        expires: 365,\n        secure: window.location.protocol === \"https:\"\n      });\n      this.updateModalSelections();\n      this.triggerState();\n    }\n  }, {\n    key: \"triggerJavaScripts\",\n    value: function triggerJavaScripts() {\n      var _this = this;\n      document.querySelectorAll(\"script[type='text/plain'][data-consent]\").forEach(function (script) {\n        if (_this.state[script.dataset.consent]) {\n          var activeScript = document.createElement(\"script\");\n          if (script.src.length > 0) {\n            activeScript.src = script.src;\n          } else {\n            activeScript.innerHTML = script.innerHTML;\n          }\n          script.parentNode.replaceChild(activeScript, script);\n        }\n      });\n      var event = new CustomEvent(\"dataconsent\", {\n        detail: this.state\n      });\n      document.dispatchEvent(event);\n    }\n  }, {\n    key: \"triggerIframes\",\n    value: function triggerIframes() {\n      if (this.allAccepted()) {\n        document.querySelectorAll(\".disabled-iframe\").forEach(function (original) {\n          if (original.childNodes && original.childNodes.length) {\n            var content = Array.from(original.childNodes).find(function (childNode) {\n              return childNode.nodeType === Node.COMMENT_NODE;\n            });\n            if (!content) {\n              return;\n            }\n            var newElement = document.createElement(\"div\");\n            newElement.innerHTML = content.nodeValue;\n            original.parentNode.replaceChild(newElement.firstElementChild, original);\n          }\n        });\n      } else {\n        document.querySelectorAll(\"iframe\").forEach(function (original) {\n          var newElement = document.createElement(\"div\");\n          newElement.className = \"disabled-iframe\";\n          newElement.appendChild(document.createComment(\"\".concat(original.outerHTML)));\n          original.parentNode.replaceChild(newElement, original);\n        });\n      }\n    }\n  }, {\n    key: \"triggerWarnings\",\n    value: function triggerWarnings() {\n      var _this2 = this;\n      document.querySelectorAll(\".disabled-iframe\").forEach(function (original) {\n        if (original.querySelector(\".dataconsent-warning\")) {\n          return;\n        }\n        var cloned = _this2.warningElement.cloneNode(true);\n        cloned.classList.remove(\"hide\");\n        original.appendChild(cloned);\n      });\n    }\n  }, {\n    key: \"triggerState\",\n    value: function triggerState() {\n      this.triggerJavaScripts();\n      this.triggerIframes();\n      this.triggerWarnings();\n    }\n  }, {\n    key: \"allAccepted\",\n    value: function allAccepted() {\n      var _this3 = this;\n      return this.categories.every(function (category) {\n        return _this3.state[category] === true;\n      });\n    }\n  }, {\n    key: \"updateModalSelections\",\n    value: function updateModalSelections() {\n      var _this4 = this;\n      var categoryElements = this.modal.querySelectorAll(\".category-wrapper\");\n      categoryElements.forEach(function (categoryEl) {\n        var categoryInput = categoryEl.querySelector(\"input\");\n        if (_this4.state && _this4.state[categoryInput.name]) {\n          categoryInput.checked = true;\n        } else if (!categoryInput.disabled) {\n          categoryInput.checked = false;\n        }\n      });\n    }\n  }, {\n    key: \"saveSettings\",\n    value: function saveSettings(newState) {\n      this.updateState(newState);\n    }\n  }, {\n    key: \"acceptAll\",\n    value: function acceptAll() {\n      var newState = {};\n      this.categories.forEach(function (category) {\n        newState[category] = true;\n      });\n      this.updateState(newState);\n    }\n  }, {\n    key: \"rejectAll\",\n    value: function rejectAll() {\n      this.updateState({\n        essential: true\n      });\n    }\n  }, {\n    key: \"getState\",\n    value: function getState() {\n      return this.state;\n    }\n  }]);\n  return ConsentManager;\n}();\nexport default ConsentManager;","map":{"version":3,"names":["Cookies","ConsentManager","options","_classCallCheck","modal","categories","cookieName","cookie","get","warningElement","updateState","JSON","parse","_createClass","key","value","newState","state","set","stringify","domain","document","location","host","split","sameSite","expires","secure","window","protocol","updateModalSelections","triggerState","triggerJavaScripts","_this","querySelectorAll","forEach","script","dataset","consent","activeScript","createElement","src","length","innerHTML","parentNode","replaceChild","event","CustomEvent","detail","dispatchEvent","triggerIframes","allAccepted","original","childNodes","content","Array","from","find","childNode","nodeType","Node","COMMENT_NODE","newElement","nodeValue","firstElementChild","className","appendChild","createComment","concat","outerHTML","triggerWarnings","_this2","querySelector","cloned","cloneNode","classList","remove","_this3","every","category","_this4","categoryElements","categoryEl","categoryInput","name","checked","disabled","saveSettings","acceptAll","rejectAll","essential","getState"],"sources":["/home/nico/.rbenv/versions/3.0.2/lib/ruby/gems/3.0.0/gems/decidim-core-0.27.3/app/packs/src/decidim/data_consent/consent_manager.js"],"sourcesContent":["import Cookies from \"js-cookie\";\n\nclass ConsentManager {\n  // Options should contain the following keys:\n  // - modal - HTML element of the data consent modal (e.g. \"<div id=\"dc-modal\">Foo bar</div>\")\n  // - categories - Available data consent categories (e.g. [\"essential\", \"preferences\", \"analytics\", \"marketing\"])\n  // - cookieName - Name of the cookie saved in the browser (e.g. \"decidim-consent\")\n  // - warningElement - HTML element to be shown when user has not given the necessary data consent to display the content.\n  constructor(options) {\n    this.modal = options.modal;\n    this.categories = options.categories;\n    this.cookieName = options.cookieName;\n    this.cookie = Cookies.get(this.cookieName);\n    this.warningElement = options.warningElement;\n    if (this.cookie) {\n      this.updateState(JSON.parse(this.cookie));\n    } else {\n      this.updateState({});\n    }\n  }\n\n  updateState(newState) {\n    this.state = newState;\n    Cookies.set(this.cookieName, JSON.stringify(this.state), {\n      domain: document.location.host.split(\":\")[0],\n      sameSite: \"Lax\",\n      expires: 365,\n      secure: window.location.protocol === \"https:\"\n    });\n    this.updateModalSelections();\n    this.triggerState();\n  }\n\n  triggerJavaScripts() {\n    document.querySelectorAll(\"script[type='text/plain'][data-consent]\").forEach((script) => {\n      if (this.state[script.dataset.consent]) {\n        const activeScript = document.createElement(\"script\");\n        if (script.src.length > 0) {\n          activeScript.src = script.src;\n        } else {\n          activeScript.innerHTML = script.innerHTML;\n        }\n        script.parentNode.replaceChild(activeScript, script);\n      }\n    });\n\n    const event = new CustomEvent(\"dataconsent\", { detail: this.state });\n    document.dispatchEvent(event);\n  }\n\n  triggerIframes() {\n    if (this.allAccepted()) {\n      document.querySelectorAll(\".disabled-iframe\").forEach((original) => {\n        if (original.childNodes && original.childNodes.length) {\n          const content = Array.from(original.childNodes).find((childNode) => {\n            return childNode.nodeType === Node.COMMENT_NODE;\n          });\n          if (!content) {\n            return;\n          }\n          const newElement = document.createElement(\"div\");\n          newElement.innerHTML = content.nodeValue;\n          original.parentNode.replaceChild(newElement.firstElementChild, original);\n        }\n      });\n    } else {\n      document.querySelectorAll(\"iframe\").forEach((original) => {\n        const newElement = document.createElement(\"div\");\n        newElement.className = \"disabled-iframe\";\n        newElement.appendChild(document.createComment(`${original.outerHTML}`));\n        original.parentNode.replaceChild(newElement, original);\n      });\n    }\n  }\n\n  triggerWarnings() {\n    document.querySelectorAll(\".disabled-iframe\").forEach((original) => {\n      if (original.querySelector(\".dataconsent-warning\")) {\n        return;\n      }\n\n      let cloned = this.warningElement.cloneNode(true);\n      cloned.classList.remove(\"hide\");\n      original.appendChild(cloned);\n    });\n  }\n\n  triggerState() {\n    this.triggerJavaScripts();\n    this.triggerIframes();\n    this.triggerWarnings();\n  }\n\n  allAccepted() {\n    return this.categories.every((category) => {\n      return this.state[category] === true;\n    });\n  }\n\n  updateModalSelections() {\n    const categoryElements = this.modal.querySelectorAll(\".category-wrapper\");\n\n    categoryElements.forEach((categoryEl) => {\n      const categoryInput = categoryEl.querySelector(\"input\");\n      if (this.state && this.state[categoryInput.name]) {\n        categoryInput.checked = true;\n      } else if (!categoryInput.disabled) {\n        categoryInput.checked = false;\n      }\n    });\n  }\n\n  saveSettings(newState) {\n    this.updateState(newState);\n  }\n\n  acceptAll() {\n    const newState = {};\n    this.categories.forEach((category) => {\n      newState[category] = true;\n    });\n    this.updateState(newState);\n  }\n\n  rejectAll() {\n    this.updateState({\n      essential: true\n    });\n  }\n\n  getState() {\n    return this.state;\n  }\n}\n\nexport default ConsentManager\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}