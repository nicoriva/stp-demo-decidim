{"ast":null,"code":"/* eslint no-unused-vars: 0 */\nimport Tribute from \"src/decidim/vendor/tribute\";\n$(function () {\n  var $hashtagContainer = $(\".js-hashtags\");\n  var nodatafound = $hashtagContainer.attr(\"data-noresults\");\n  var noMatchTemplate = null;\n  if (nodatafound) {\n    noMatchTemplate = function noMatchTemplate() {\n      return \"<li>\".concat(nodatafound, \"</li>\");\n    };\n  }\n\n  // Listener for the event triggered by quilljs\n  var cursor = \"\";\n  $hashtagContainer.on(\"quill-position\", function (event) {\n    if (event.detail !== null) {\n      // When replacing the text content after selecting a hashtag, we only need\n      // to know the hashtag's start position as that is the point which we want\n      // to replace.\n      var quill = event.target.__quill;\n      if (quill.getText(event.detail.index - 1, 1) === \"#\") {\n        cursor = event.detail.index;\n      }\n    }\n  });\n\n  /* eslint no-use-before-define: [\"error\", { \"variables\": false }]*/\n  var remoteSearch = function remoteSearch(text, cb) {\n    $.post(\"/api\", {\n      query: \"{hashtags(name:\\\"\".concat(text, \"\\\") {name}}\")\n    }).then(function (response) {\n      var data = response.data.hashtags || {};\n      cb(data);\n    }).fail(function () {\n      cb([]);\n    }).always(function () {\n      // This function runs Tribute every single time you type something\n      // So we must evalute DOM properties after each\n      var $parent = $(tribute.current.element).parent();\n      $parent.addClass(\"is-active\");\n\n      // We need to move the container to the wrapper selected\n      var $tribute = $parent.find(\".tribute-container\");\n      // Remove the inline styles, relative to absolute positioning\n      $tribute.removeAttr(\"style\");\n    });\n  };\n\n  // tribute.js docs - http://github.com/zurb/tribute\n  /* global Tribute*/\n  var tribute = new Tribute({\n    trigger: \"#\",\n    values: function values(text, cb) {\n      remoteSearch(text, function (hashtags) {\n        return cb(hashtags);\n      });\n    },\n    positionMenu: true,\n    menuContainer: null,\n    fillAttr: \"name\",\n    noMatchTemplate: noMatchTemplate,\n    lookup: function lookup(item) {\n      return item.name;\n    },\n    selectTemplate: function selectTemplate(item) {\n      if (typeof item === \"undefined\") {\n        return null;\n      }\n      if (this.range.isContentEditable(this.current.element)) {\n        // Check quill.js\n        if ($(this.current.element).hasClass(\"ql-editor\")) {\n          var editorContainer = $(this.current.element).parent().get(0);\n          var quill = editorContainer.__quill;\n          quill.insertText(cursor - 1, \"#\".concat(item.original.name, \" \"), Quill.sources.API);\n          // cursor position + hashtag length + \"#\" sign + space\n          var position = cursor + item.original.name.length + 2;\n          var next = 0;\n          if (quill.getLength() > position) {\n            next = position;\n          } else {\n            next = quill.getLength() - 1;\n          }\n          // Workaround https://github.com/quilljs/quill/issues/731\n          setTimeout(function () {\n            quill.setSelection(next, 0);\n          }, 500);\n          return \"\";\n        }\n        return \"<span contenteditable=\\\"false\\\">#\".concat(item.original.name, \"</span>\");\n      }\n      return \"#\".concat(item.original.name);\n    },\n    menuItemTemplate: function menuItemTemplate(item) {\n      var tpl = \"<strong>\".concat(item.original.name, \"</strong>\");\n      return tpl;\n    }\n  });\n\n  // Tribute needs to be attached to the `.ql-editor` element as said at:\n  // https://github.com/quilljs/quill/issues/1816\n  //\n  // For this reason we need to wait a bit for quill to initialize itself.\n  setTimeout(function () {\n    $hashtagContainer.each(function (index, item) {\n      var $qlEditor = $(\".ql-editor\", item);\n      if ($qlEditor.length > 0) {\n        tribute.attach($qlEditor);\n      } else {\n        tribute.attach(item);\n      }\n    });\n  }, 1000);\n\n  // DOM manipulation\n  $hashtagContainer.on(\"focusin\", function (event) {\n    // Set the parent container relative to the current element\n\n    tribute.menuContainer = event.target.parentNode;\n  });\n  $hashtagContainer.on(\"focusout\", function (event) {\n    var $parent = $(event.target).parent();\n    if ($parent.hasClass(\"is-active\")) {\n      $parent.removeClass(\"is-active\");\n    }\n  });\n  $hashtagContainer.on(\"input\", function (event) {\n    var $parent = $(event.target).parent();\n    if (tribute.isActive) {\n      // We need to move the container to the wrapper selected\n      var $tribute = $(\".tribute-container\");\n      $tribute.appendTo($parent);\n      // Parent adaptation\n      $parent.addClass(\"is-active\");\n    } else {\n      $parent.removeClass(\"is-active\");\n    }\n  });\n});","map":{"version":3,"names":["Tribute","$","$hashtagContainer","nodatafound","attr","noMatchTemplate","concat","cursor","on","event","detail","quill","target","__quill","getText","index","remoteSearch","text","cb","post","query","then","response","data","hashtags","fail","always","$parent","tribute","current","element","parent","addClass","$tribute","find","removeAttr","trigger","values","positionMenu","menuContainer","fillAttr","lookup","item","name","selectTemplate","range","isContentEditable","hasClass","editorContainer","get","insertText","original","Quill","sources","API","position","length","next","getLength","setTimeout","setSelection","menuItemTemplate","tpl","each","$qlEditor","attach","parentNode","removeClass","isActive","appendTo"],"sources":["/home/nico/.rbenv/versions/3.0.2/lib/ruby/gems/3.0.0/gems/decidim-core-0.27.3/app/packs/src/decidim/input_hashtags.js"],"sourcesContent":["/* eslint no-unused-vars: 0 */\nimport Tribute from \"src/decidim/vendor/tribute\"\n\n$(() => {\n  const $hashtagContainer = $(\".js-hashtags\");\n  const nodatafound = $hashtagContainer.attr(\"data-noresults\");\n\n  let noMatchTemplate = null\n  if (nodatafound) {\n    noMatchTemplate = () => `<li>${nodatafound}</li>`;\n  }\n\n  // Listener for the event triggered by quilljs\n  let cursor = \"\";\n  $hashtagContainer.on(\"quill-position\", function(event) {\n    if (event.detail !== null) {\n      // When replacing the text content after selecting a hashtag, we only need\n      // to know the hashtag's start position as that is the point which we want\n      // to replace.\n      let quill = event.target.__quill;\n      if (quill.getText(event.detail.index - 1, 1) === \"#\") {\n        cursor = event.detail.index;\n      }\n    }\n  });\n\n  /* eslint no-use-before-define: [\"error\", { \"variables\": false }]*/\n  let remoteSearch = function(text, cb) {\n    $.post(\"/api\", {query: `{hashtags(name:\"${text}\") {name}}`}).\n\n      then((response) => {\n        let data = response.data.hashtags || {};\n        cb(data)\n      }).fail(function() {\n        cb([])\n      }).always(() => {\n      // This function runs Tribute every single time you type something\n      // So we must evalute DOM properties after each\n        const $parent = $(tribute.current.element).parent()\n        $parent.addClass(\"is-active\")\n\n        // We need to move the container to the wrapper selected\n        const $tribute = $parent.find(\".tribute-container\");\n        // Remove the inline styles, relative to absolute positioning\n        $tribute.removeAttr(\"style\");\n      })\n  };\n\n  // tribute.js docs - http://github.com/zurb/tribute\n  /* global Tribute*/\n  let tribute = new Tribute({\n    trigger: \"#\",\n    values: function (text, cb) {\n      remoteSearch(text, (hashtags) => cb(hashtags));\n    },\n    positionMenu: true,\n    menuContainer: null,\n    fillAttr: \"name\",\n    noMatchTemplate: noMatchTemplate,\n    lookup: (item) => item.name,\n    selectTemplate: function(item) {\n      if (typeof item === \"undefined\") {\n        return null;\n      }\n      if (this.range.isContentEditable(this.current.element)) {\n        // Check quill.js\n        if ($(this.current.element).hasClass(\"ql-editor\")) {\n          let editorContainer = $(this.current.element).parent().get(0);\n          let quill = editorContainer.__quill;\n          quill.insertText(cursor - 1, `#${item.original.name} `, Quill.sources.API);\n          // cursor position + hashtag length + \"#\" sign + space\n          let position = cursor + item.original.name.length + 2;\n\n          let next = 0;\n          if (quill.getLength() > position) {\n            next = position\n          } else {\n            next = quill.getLength() - 1\n          }\n          // Workaround https://github.com/quilljs/quill/issues/731\n          setTimeout(function () {\n            quill.setSelection(next, 0);\n          }, 500);\n\n          return \"\"\n        }\n        return `<span contenteditable=\"false\">#${item.original.name}</span>`;\n      }\n      return `#${item.original.name}`;\n    },\n    menuItemTemplate: function(item) {\n      let tpl = `<strong>${item.original.name}</strong>`;\n      return tpl;\n    }\n  });\n\n  // Tribute needs to be attached to the `.ql-editor` element as said at:\n  // https://github.com/quilljs/quill/issues/1816\n  //\n  // For this reason we need to wait a bit for quill to initialize itself.\n  setTimeout(function() {\n    $hashtagContainer.each((index, item) => {\n      let $qlEditor = $(\".ql-editor\", item);\n      if ($qlEditor.length > 0) {\n        tribute.attach($qlEditor);\n      } else {\n        tribute.attach(item);\n      }\n    });\n  }, 1000);\n\n  // DOM manipulation\n  $hashtagContainer.on(\"focusin\", (event) => {\n    // Set the parent container relative to the current element\n\n    tribute.menuContainer = event.target.parentNode;\n  });\n  $hashtagContainer.on(\"focusout\", (event) => {\n    let $parent = $(event.target).parent();\n\n    if ($parent.hasClass(\"is-active\")) {\n      $parent.removeClass(\"is-active\");\n    }\n  });\n  $hashtagContainer.on(\"input\", (event) => {\n    let $parent = $(event.target).parent();\n\n    if (tribute.isActive) {\n      // We need to move the container to the wrapper selected\n      let $tribute = $(\".tribute-container\");\n      $tribute.appendTo($parent);\n      // Parent adaptation\n      $parent.addClass(\"is-active\");\n    } else {\n      $parent.removeClass(\"is-active\");\n    }\n  });\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}