{"ast":null,"code":"import \"src/decidim/geocoding\";\nimport formatAddress from \"src/decidim/geocoding/format_address\";\n\n/**\n * For the available address format keys, refer to:\n * https://github.com/komoot/photon\n */\n$(function () {\n  var generateAddressLabel = formatAddress;\n  $(\"[data-decidim-geocoding]\").each(function (_i, el) {\n    var $input = $(el);\n    var config = $input.data(\"decidim-geocoding\");\n    var queryMinLength = config.queryMinLength || 2;\n    // Default Photon installation only supports these languages but for\n    // custom instances, you can configure the supported languages.\n    var supportedLanguages = config.supportedLanguages || [\"de\", \"en\", \"it\", \"fr\"];\n    var defaultLanguage = config.defaultLanguage || \"en\";\n    var addressFormat = config.addressFormat || [\"name\", [\"street\", \"housenumber\"], \"postcode\", \"city\", \"state\", \"country\"];\n    var language = $(\"html\").attr(\"lang\");\n    if (!supportedLanguages.includes(language)) {\n      language = defaultLanguage;\n    }\n    var currentSuggestionQuery = null;\n    if (!config.url || config.url.length < 1) {\n      return;\n    }\n    $input.on(\"geocoder-suggest.decidim\", function (_ev, query, callback) {\n      clearTimeout(currentSuggestionQuery);\n\n      // Do not trigger API calls on short queries\n      if (\"\".concat(query).trim().length < queryMinLength) {\n        return;\n      }\n      currentSuggestionQuery = setTimeout(function () {\n        $.ajax({\n          method: \"GET\",\n          url: config.url,\n          data: {\n            q: query,\n            // eslint-disable-line\n            lang: language\n          },\n          dataType: \"json\"\n        }).done(function (resp) {\n          if (resp.features) {\n            return callback(resp.features.map(function (item) {\n              var label = generateAddressLabel(item.properties, addressFormat);\n              return {\n                key: label,\n                value: label,\n                coordinates: item.geometry.coordinates\n              };\n            }));\n          }\n          return null;\n        });\n      }, 200);\n    });\n  });\n});","map":{"version":3,"names":["formatAddress","$","generateAddressLabel","each","_i","el","$input","config","data","queryMinLength","supportedLanguages","defaultLanguage","addressFormat","language","attr","includes","currentSuggestionQuery","url","length","on","_ev","query","callback","clearTimeout","concat","trim","setTimeout","ajax","method","q","lang","dataType","done","resp","features","map","item","label","properties","key","value","coordinates","geometry"],"sources":["/home/nico/.rbenv/versions/3.0.2/lib/ruby/gems/3.0.0/gems/decidim-core-0.27.3/app/packs/src/decidim/geocoding/provider/photon.js"],"sourcesContent":["import \"src/decidim/geocoding\"\nimport formatAddress from \"src/decidim/geocoding/format_address\"\n\n/**\n * For the available address format keys, refer to:\n * https://github.com/komoot/photon\n */\n$(() => {\n  const generateAddressLabel = formatAddress;\n\n  $(\"[data-decidim-geocoding]\").each((_i, el) => {\n    const $input = $(el);\n    const config = $input.data(\"decidim-geocoding\");\n    const queryMinLength = config.queryMinLength || 2;\n    // Default Photon installation only supports these languages but for\n    // custom instances, you can configure the supported languages.\n    const supportedLanguages = config.supportedLanguages || [\"de\", \"en\", \"it\", \"fr\"];\n    const defaultLanguage  = config.defaultLanguage || \"en\";\n    const addressFormat = config.addressFormat || [\n      \"name\",\n      [\"street\", \"housenumber\"],\n      \"postcode\",\n      \"city\",\n      \"state\",\n      \"country\"\n    ];\n    let language = $(\"html\").attr(\"lang\");\n    if (!supportedLanguages.includes(language)) {\n      language = defaultLanguage;\n    }\n    let currentSuggestionQuery = null;\n\n    if (!config.url || config.url.length < 1) {\n      return;\n    }\n\n    $input.on(\"geocoder-suggest.decidim\", (_ev, query, callback) => {\n      clearTimeout(currentSuggestionQuery);\n\n      // Do not trigger API calls on short queries\n      if (`${query}`.trim().length < queryMinLength) {\n        return;\n      }\n\n      currentSuggestionQuery = setTimeout(() => {\n        $.ajax({\n          method: \"GET\",\n          url: config.url,\n          data: {\n            q: query, // eslint-disable-line\n            lang: language\n          },\n          dataType: \"json\"\n        }).done((resp) => {\n          if (resp.features) {\n            return callback(resp.features.map((item) => {\n              const label = generateAddressLabel(item.properties, addressFormat);\n\n              return {\n                key: label,\n                value: label,\n                coordinates: item.geometry.coordinates\n              }\n            }));\n          }\n          return null;\n        });\n      }, 200);\n    });\n  })\n});\n"],"mappings":"AAAA,OAAO,uBAAuB;AAC9B,OAAOA,aAAa,MAAM,sCAAsC;;AAEhE;AACA;AACA;AACA;AACAC,CAAC,CAAC,YAAM;EACN,IAAMC,oBAAoB,GAAGF,aAAa;EAE1CC,CAAC,CAAC,0BAA0B,CAAC,CAACE,IAAI,CAAC,UAACC,EAAE,EAAEC,EAAE,EAAK;IAC7C,IAAMC,MAAM,GAAGL,CAAC,CAACI,EAAE,CAAC;IACpB,IAAME,MAAM,GAAGD,MAAM,CAACE,IAAI,CAAC,mBAAmB,CAAC;IAC/C,IAAMC,cAAc,GAAGF,MAAM,CAACE,cAAc,IAAI,CAAC;IACjD;IACA;IACA,IAAMC,kBAAkB,GAAGH,MAAM,CAACG,kBAAkB,IAAI,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;IAChF,IAAMC,eAAe,GAAIJ,MAAM,CAACI,eAAe,IAAI,IAAI;IACvD,IAAMC,aAAa,GAAGL,MAAM,CAACK,aAAa,IAAI,CAC5C,MAAM,EACN,CAAC,QAAQ,EAAE,aAAa,CAAC,EACzB,UAAU,EACV,MAAM,EACN,OAAO,EACP,SAAS,CACV;IACD,IAAIC,QAAQ,GAAGZ,CAAC,CAAC,MAAM,CAAC,CAACa,IAAI,CAAC,MAAM,CAAC;IACrC,IAAI,CAACJ,kBAAkB,CAACK,QAAQ,CAACF,QAAQ,CAAC,EAAE;MAC1CA,QAAQ,GAAGF,eAAe;IAC5B;IACA,IAAIK,sBAAsB,GAAG,IAAI;IAEjC,IAAI,CAACT,MAAM,CAACU,GAAG,IAAIV,MAAM,CAACU,GAAG,CAACC,MAAM,GAAG,CAAC,EAAE;MACxC;IACF;IAEAZ,MAAM,CAACa,EAAE,CAAC,0BAA0B,EAAE,UAACC,GAAG,EAAEC,KAAK,EAAEC,QAAQ,EAAK;MAC9DC,YAAY,CAACP,sBAAsB,CAAC;;MAEpC;MACA,IAAI,GAAAQ,MAAA,CAAGH,KAAK,EAAGI,IAAI,CAAC,CAAC,CAACP,MAAM,GAAGT,cAAc,EAAE;QAC7C;MACF;MAEAO,sBAAsB,GAAGU,UAAU,CAAC,YAAM;QACxCzB,CAAC,CAAC0B,IAAI,CAAC;UACLC,MAAM,EAAE,KAAK;UACbX,GAAG,EAAEV,MAAM,CAACU,GAAG;UACfT,IAAI,EAAE;YACJqB,CAAC,EAAER,KAAK;YAAE;YACVS,IAAI,EAAEjB;UACR,CAAC;UACDkB,QAAQ,EAAE;QACZ,CAAC,CAAC,CAACC,IAAI,CAAC,UAACC,IAAI,EAAK;UAChB,IAAIA,IAAI,CAACC,QAAQ,EAAE;YACjB,OAAOZ,QAAQ,CAACW,IAAI,CAACC,QAAQ,CAACC,GAAG,CAAC,UAACC,IAAI,EAAK;cAC1C,IAAMC,KAAK,GAAGnC,oBAAoB,CAACkC,IAAI,CAACE,UAAU,EAAE1B,aAAa,CAAC;cAElE,OAAO;gBACL2B,GAAG,EAAEF,KAAK;gBACVG,KAAK,EAAEH,KAAK;gBACZI,WAAW,EAAEL,IAAI,CAACM,QAAQ,CAACD;cAC7B,CAAC;YACH,CAAC,CAAC,CAAC;UACL;UACA,OAAO,IAAI;QACb,CAAC,CAAC;MACJ,CAAC,EAAE,GAAG,CAAC;IACT,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}