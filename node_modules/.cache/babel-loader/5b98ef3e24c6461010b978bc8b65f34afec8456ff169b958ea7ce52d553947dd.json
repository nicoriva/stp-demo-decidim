{"ast":null,"code":"function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"];\n  if (null != _i) {\n    var _s,\n      _e,\n      _x,\n      _r,\n      _arr = [],\n      _n = !0,\n      _d = !1;\n    try {\n      if (_x = (_i = _i.call(arr)).next, 0 === i) {\n        if (Object(_i) !== _i) return;\n        _n = !1;\n      } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);\n    } catch (err) {\n      _d = !0, _e = err;\n    } finally {\n      try {\n        if (!_n && null != _i[\"return\"] && (_r = _i[\"return\"](), Object(_r) !== _r)) return;\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n}\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}\nfunction _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\nimport { DirectUpload } from \"@rails/activestorage\";\nexport var Uploader = /*#__PURE__*/function () {\n  function Uploader(modal, uploadItem, options) {\n    _classCallCheck(this, Uploader);\n    this.modal = modal;\n    this.uploadItem = uploadItem;\n    this.progressBar = uploadItem.querySelector(\".progress-bar\");\n    this.validationSent = false;\n    this.fileTooBig = false;\n    if (modal.options.maxFileSize && options.file.size > modal.options.maxFileSize) {\n      this.fileTooBig = true;\n      this.showError([modal.locales.file_size_too_large]);\n    } else {\n      this.upload = new DirectUpload(options.file, options.url, this);\n    }\n  }\n  _createClass(Uploader, [{\n    key: \"showError\",\n    value: function showError(errors) {\n      this.progressBar.classList.add(\"filled\");\n      this.progressBar.innerHTML = this.modal.locales.validation_error;\n      this.uploadItem.dataset.state = \"error\";\n      var errorList = this.uploadItem.querySelector(\".upload-errors\");\n      errors.forEach(function (error) {\n        var errorItem = document.createElement(\"li\");\n        errorItem.classList.add(\"form-error\", \"is-visible\");\n        errorItem.innerHTML = error;\n        errorList.appendChild(errorItem);\n      });\n    }\n  }, {\n    key: \"validate\",\n    value: function validate(blobId) {\n      var _this = this;\n      var callback = function callback(data) {\n        var errors = [];\n        for (var _i = 0, _Object$entries = Object.entries(data); _i < _Object$entries.length; _i++) {\n          var _Object$entries$_i = _slicedToArray(_Object$entries[_i], 2),\n            value = _Object$entries$_i[1];\n          errors = errors.concat(value);\n        }\n        _this.progressBar.style.justifyContent = \"center\";\n        if (errors.length === 0) {\n          _this.progressBar.innerHTML = _this.modal.locales.uploaded;\n          _this.uploadItem.dataset.state = \"validated\";\n        } else {\n          _this.showError(errors);\n        }\n        _this.progressBar.classList.add(\"filled\");\n      };\n      if (!this.validationSent) {\n        var property = this.modal.options.addAttribute;\n        if (this.modal.options.titled) {\n          property = \"file\";\n        }\n        var params = new URLSearchParams({\n          resourceClass: this.modal.options.resourceClass,\n          property: property,\n          blob: blobId,\n          formClass: this.modal.options.formObjectClass\n        });\n        fetch(\"/upload_validations?\".concat(params.toString()), {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            \"X-CSRF-Token\": $(\"meta[name=csrf-token]\").attr(\"content\")\n          }\n        }).then(function (response) {\n          return response.json();\n        }).then(function (data) {\n          callback(data);\n        });\n        this.validationSent = true;\n      }\n    }\n  }, {\n    key: \"directUploadWillStoreFileWithXHR\",\n    value: function directUploadWillStoreFileWithXHR(request) {\n      var _this2 = this;\n      request.upload.addEventListener(\"progress\", function (event) {\n        var progress = Math.floor(event.loaded / event.total * 100);\n        var width = \"15%\";\n        if (progress > 15) {\n          width = \"\".concat(progress, \"%\");\n        }\n        _this2.progressBar.style.width = width;\n        if (progress === 100) {\n          _this2.progressBar.innerHTML = _this2.modal.locales.validating;\n          return;\n        }\n        _this2.progressBar.innerHTML = \"\".concat(progress, \"%\");\n      });\n    }\n  }]);\n  return Uploader;\n}();","map":{"version":3,"names":["DirectUpload","Uploader","modal","uploadItem","options","_classCallCheck","progressBar","querySelector","validationSent","fileTooBig","maxFileSize","file","size","showError","locales","file_size_too_large","upload","url","_createClass","key","value","errors","classList","add","innerHTML","validation_error","dataset","state","errorList","forEach","error","errorItem","document","createElement","appendChild","validate","blobId","_this","callback","data","_i","_Object$entries","Object","entries","length","_Object$entries$_i","_slicedToArray","concat","style","justifyContent","uploaded","property","addAttribute","titled","params","URLSearchParams","resourceClass","blob","formClass","formObjectClass","fetch","toString","method","headers","$","attr","then","response","json","directUploadWillStoreFileWithXHR","request","_this2","addEventListener","event","progress","Math","floor","loaded","total","width","validating"],"sources":["/home/nico/.rbenv/versions/3.0.2/lib/ruby/gems/3.0.0/gems/decidim-core-0.27.3/app/packs/src/decidim/direct_uploads/uploader.js"],"sourcesContent":["import { DirectUpload } from \"@rails/activestorage\";\n\nexport class Uploader {\n  constructor(modal, uploadItem, options) {\n    this.modal = modal;\n    this.uploadItem = uploadItem;\n    this.progressBar = uploadItem.querySelector(\".progress-bar\");\n    this.validationSent = false;\n    this.fileTooBig = false;\n    if (modal.options.maxFileSize && options.file.size > modal.options.maxFileSize) {\n      this.fileTooBig = true;\n      this.showError([modal.locales.file_size_too_large]);\n    } else {\n      this.upload = new DirectUpload(options.file, options.url, this);\n    }\n  }\n\n  showError(errors) {\n    this.progressBar.classList.add(\"filled\");\n    this.progressBar.innerHTML = this.modal.locales.validation_error;\n    this.uploadItem.dataset.state = \"error\";\n    const errorList = this.uploadItem.querySelector(\".upload-errors\");\n    errors.forEach((error) => {\n      const errorItem = document.createElement(\"li\");\n      errorItem.classList.add(\"form-error\", \"is-visible\");\n      errorItem.innerHTML = error;\n      errorList.appendChild(errorItem);\n    })\n  }\n\n  validate(blobId) {\n    const callback = (data) => {\n      let errors = []\n      for (const [, value] of Object.entries(data)) {\n        errors = errors.concat(value);\n      }\n\n      this.progressBar.style.justifyContent = \"center\";\n      if (errors.length === 0) {\n        this.progressBar.innerHTML = this.modal.locales.uploaded;\n        this.uploadItem.dataset.state = \"validated\";\n      } else {\n        this.showError(errors);\n      }\n      this.progressBar.classList.add(\"filled\");\n    }\n\n    if (!this.validationSent) {\n      let property = this.modal.options.addAttribute;\n      if (this.modal.options.titled) {\n        property = \"file\"\n      }\n      const params = new URLSearchParams({\n        resourceClass: this.modal.options.resourceClass,\n        property: property,\n        blob: blobId,\n        formClass: this.modal.options.formObjectClass\n      });\n\n      fetch(`/upload_validations?${params.toString()}`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"X-CSRF-Token\": $(\"meta[name=csrf-token]\").attr(\"content\")\n        }\n      }).then((response) => response.json()).then((data) => {\n        callback(data);\n      });\n      this.validationSent = true;\n    }\n  }\n\n  directUploadWillStoreFileWithXHR(request) {\n    request.upload.addEventListener(\"progress\", (event) => {\n      const progress = Math.floor(event.loaded / event.total * 100);\n      let width = \"15%\";\n      if (progress > 15) {\n        width = `${progress}%`;\n      }\n      this.progressBar.style.width = width;\n\n      if (progress === 100) {\n        this.progressBar.innerHTML = this.modal.locales.validating;\n        return;\n      }\n      this.progressBar.innerHTML = `${progress}%`;\n    });\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}