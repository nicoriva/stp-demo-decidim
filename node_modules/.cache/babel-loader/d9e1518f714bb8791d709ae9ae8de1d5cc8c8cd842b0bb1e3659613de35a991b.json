{"ast":null,"code":"function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}\nfunction _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n  return _assertThisInitialized(self);\n}\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return self;\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\nimport \"src/decidim/vendor/jquery-tmpl\";\nimport * as L from \"leaflet\";\nimport MapController from \"src/decidim/map/controller\";\nimport \"leaflet.markercluster\";\nvar MapMarkersController = /*#__PURE__*/function (_MapController) {\n  _inherits(MapMarkersController, _MapController);\n  var _super = _createSuper(MapMarkersController);\n  function MapMarkersController() {\n    _classCallCheck(this, MapMarkersController);\n    return _super.apply(this, arguments);\n  }\n  _createClass(MapMarkersController, [{\n    key: \"start\",\n    value: function start() {\n      this.markerClusters = null;\n      if (Array.isArray(this.config.markers) && this.config.markers.length > 0) {\n        this.addMarkers(this.config.markers);\n      } else {\n        this.map.fitWorld();\n      }\n    }\n  }, {\n    key: \"addMarkers\",\n    value: function addMarkers(markersData) {\n      var _this = this;\n      if (this.markerClusters === null) {\n        this.markerClusters = new L.MarkerClusterGroup();\n        this.map.addLayer(this.markerClusters);\n      }\n\n      // Pre-compiles the template\n      $.template(this.config.popupTemplateId, $(\"#\".concat(this.config.popupTemplateId)).html());\n      var bounds = new L.LatLngBounds(markersData.map(function (markerData) {\n        return [markerData.latitude, markerData.longitude];\n      }));\n      markersData.forEach(function (markerData) {\n        var marker = new L.Marker([markerData.latitude, markerData.longitude], {\n          icon: _this.createIcon(),\n          keyboard: true,\n          title: markerData.title\n        });\n        var node = document.createElement(\"div\");\n        $.tmpl(_this.config.popupTemplateId, markerData).appendTo(node);\n        marker.bindPopup(node, {\n          maxwidth: 640,\n          minWidth: 500,\n          keepInView: true,\n          className: \"map-info\"\n        }).openPopup();\n        _this.markerClusters.addLayer(marker);\n      });\n\n      // Make sure there is enough space in the map for the padding to be\n      // applied. Otherwise the map will automatically zoom out (test it on\n      // mobile). Make sure there is at least the same amount of width and\n      // height available on both sides + the padding (i.e. 4x padding in\n      // total).\n      var size = this.map.getSize();\n      if (size.y >= 400 && size.x >= 400) {\n        this.map.fitBounds(bounds, {\n          padding: [100, 100]\n        });\n      } else if (size.y >= 120 && size.x >= 120) {\n        this.map.fitBounds(bounds, {\n          padding: [30, 30]\n        });\n      } else {\n        this.map.fitBounds(bounds);\n      }\n    }\n  }, {\n    key: \"clearMarkers\",\n    value: function clearMarkers() {\n      this.map.removeLayer(this.markerClusters);\n      this.markerClusters = new L.MarkerClusterGroup();\n      this.map.addLayer(this.markerClusters);\n    }\n  }]);\n  return MapMarkersController;\n}(MapController);\nexport { MapMarkersController as default };","map":{"version":3,"names":["L","MapController","MapMarkersController","_MapController","_inherits","_super","_createSuper","_classCallCheck","apply","arguments","_createClass","key","value","start","markerClusters","Array","isArray","config","markers","length","addMarkers","map","fitWorld","markersData","_this","MarkerClusterGroup","addLayer","$","template","popupTemplateId","concat","html","bounds","LatLngBounds","markerData","latitude","longitude","forEach","marker","Marker","icon","createIcon","keyboard","title","node","document","createElement","tmpl","appendTo","bindPopup","maxwidth","minWidth","keepInView","className","openPopup","size","getSize","y","x","fitBounds","padding","clearMarkers","removeLayer","default"],"sources":["/home/nico/.rbenv/versions/3.0.2/lib/ruby/gems/3.0.0/gems/decidim-core-0.27.3/app/packs/src/decidim/map/controller/markers.js"],"sourcesContent":["import \"src/decidim/vendor/jquery-tmpl\"\nimport * as L from \"leaflet\";\nimport MapController from \"src/decidim/map/controller\"\nimport \"leaflet.markercluster\";\n\nexport default class MapMarkersController extends MapController {\n  start() {\n    this.markerClusters = null;\n\n    if (Array.isArray(this.config.markers) && this.config.markers.length > 0) {\n      this.addMarkers(this.config.markers);\n    } else {\n      this.map.fitWorld();\n    }\n  }\n\n  addMarkers(markersData) {\n    if (this.markerClusters === null) {\n      this.markerClusters = new L.MarkerClusterGroup();\n      this.map.addLayer(this.markerClusters);\n    }\n\n    // Pre-compiles the template\n    $.template(\n      this.config.popupTemplateId,\n      $(`#${this.config.popupTemplateId}`).html()\n    );\n\n    const bounds = new L.LatLngBounds(\n      markersData.map(\n        (markerData) => [markerData.latitude, markerData.longitude]\n      )\n    );\n\n    markersData.forEach((markerData) => {\n      let marker = new L.Marker([markerData.latitude, markerData.longitude], {\n        icon: this.createIcon(),\n        keyboard: true,\n        title: markerData.title\n      });\n\n      let node = document.createElement(\"div\");\n\n      $.tmpl(this.config.popupTemplateId, markerData).appendTo(node);\n      marker.bindPopup(node, {\n        maxwidth: 640,\n        minWidth: 500,\n        keepInView: true,\n        className: \"map-info\"\n      }).openPopup();\n\n      this.markerClusters.addLayer(marker);\n    });\n\n    // Make sure there is enough space in the map for the padding to be\n    // applied. Otherwise the map will automatically zoom out (test it on\n    // mobile). Make sure there is at least the same amount of width and\n    // height available on both sides + the padding (i.e. 4x padding in\n    // total).\n    const size = this.map.getSize();\n    if (size.y >= 400 && size.x >= 400) {\n      this.map.fitBounds(bounds, { padding: [100, 100] });\n    } else if (size.y >= 120 && size.x >= 120) {\n      this.map.fitBounds(bounds, { padding: [30, 30] });\n    } else {\n      this.map.fitBounds(bounds);\n    }\n  }\n\n  clearMarkers() {\n    this.map.removeLayer(this.markerClusters);\n    this.markerClusters = new L.MarkerClusterGroup();\n    this.map.addLayer(this.markerClusters);\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}