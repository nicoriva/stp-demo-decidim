{"ast":null,"code":"function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nfunction _defineProperty(obj, key, value) {\n  key = _toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n  return _typeof(key) === \"symbol\" ? key : String(key);\n}\nfunction _toPrimitive(input, hint) {\n  if (_typeof(input) !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (_typeof(res) !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\n/* eslint-disable require-jsdoc, no-console */\n\nimport areachart from \"src/decidim/vizzs/areachart\";\n$(function () {\n  var metricsData = {};\n  var metricsContainer = {};\n  var metricsParams = {};\n  var query = function query() {\n    var metricsQuery = \"metrics(names: \".concat(metricsParams.names, \", space_type: \\\"\").concat(metricsParams.spaceType, \"\\\", space_id: \").concat(metricsParams.spaceId, \") { name history { key value } }\");\n    return {\n      query: \"{ \".concat(metricsQuery, \" }\")\n    };\n  };\n  var parameterize = function parameterize(metrics) {\n    metricsParams.names = JSON.stringify(metrics || []);\n    metricsParams.spaceType = $(\"#metrics #metrics-space_type\").val() || null;\n    metricsParams.spaceId = $(\"#metrics #metrics-space_id\").val() || null;\n  };\n  var fetch = function fetch(metrics) {\n    return $.post(\"/api\", query(metrics));\n  };\n  var downloadMetricData = function downloadMetricData(event) {\n    event.preventDefault();\n    var metricName = $(event.target).parents(\".metric-downloader\").data(\"metric\");\n    var csvContent = \"data:text/csv;charset=utf-8,\";\n    csvContent += \"key,value\\r\\n\";\n    metricsData[metricName].forEach(function (metricData) {\n      csvContent += \"\".concat(metricData.key, \",\").concat(metricData.value, \"\\r\\n\");\n    });\n\n    // Required for FF\n    var link = document.createElement(\"a\");\n    link.setAttribute(\"href\", encodeURI(csvContent));\n    link.setAttribute(\"download\", \"\".concat(metricName, \"_metric_data.csv\"));\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n  $(\".metric-chart:visible\").each(function (_index, container) {\n    metricsContainer[$(container).data(\"metric\")] = container;\n  });\n  $(\".metric-downloader\").each(function (_index, container) {\n    container.onclick = downloadMetricData;\n  });\n  if (!$.isEmptyObject(metricsContainer)) {\n    parameterize(Object.keys(metricsContainer));\n    fetch().then(function (response) {\n      if (response.data) {\n        $.each(response.data.metrics, function (_index, metricData) {\n          var container = metricsContainer[metricData.name];\n          if (metricData.history.length === 0) {\n            $(container).remove();\n            return;\n          }\n          var info = $(container).data(\"info\");\n          metricsData[metricData.name] = $.extend(true, [], metricData.history);\n          areachart(_objectSpread({\n            container: \"#\".concat(container.id),\n            data: metricData.history,\n            title: info.title,\n            objectName: info.object\n          }, $(container).data()));\n        });\n      } else if (response.errors) {\n        console.log(\"Something wrong happened when fetching metrics:\");\n        $.each(response.errors, function (_index, error) {\n          console.log(error.message);\n        });\n        $(\"#metrics\").remove();\n      }\n    }).fail(function (err) {\n      console.log(\"Something wrong happened when fetching metrics: \".concat(err.statusText));\n      $(\"#metrics\").remove();\n    });\n  }\n});","map":{"version":3,"names":["areachart","$","metricsData","metricsContainer","metricsParams","query","metricsQuery","concat","names","spaceType","spaceId","parameterize","metrics","JSON","stringify","val","fetch","post","downloadMetricData","event","preventDefault","metricName","target","parents","data","csvContent","forEach","metricData","key","value","link","document","createElement","setAttribute","encodeURI","body","appendChild","click","removeChild","each","_index","container","onclick","isEmptyObject","Object","keys","then","response","name","history","length","remove","info","extend","_objectSpread","id","title","objectName","object","errors","console","log","error","message","fail","err","statusText"],"sources":["/home/nico/.rbenv/versions/3.0.2/lib/ruby/gems/3.0.0/gems/decidim-core-0.27.3/app/packs/src/decidim/vizzs/index.js"],"sourcesContent":["/* eslint-disable require-jsdoc, no-console */\n\nimport areachart from \"src/decidim/vizzs/areachart\"\n\n$(() => {\n\n  const metricsData = {};\n  const metricsContainer = {};\n  const metricsParams = {};\n\n  const query = () => {\n    let metricsQuery = `metrics(names: ${metricsParams.names}, space_type: \"${metricsParams.spaceType}\", space_id: ${metricsParams.spaceId}) { name history { key value } }`;\n    return {query: `{ ${metricsQuery} }`};\n  }\n\n  const parameterize = (metrics) => {\n    metricsParams.names = JSON.stringify(metrics || []);\n    metricsParams.spaceType = $(\"#metrics #metrics-space_type\").val() || null;\n    metricsParams.spaceId = $(\"#metrics #metrics-space_id\").val() || null;\n  }\n\n  const fetch = (metrics) => $.post(\"/api\", query(metrics));\n\n  const downloadMetricData = (event) => {\n    event.preventDefault();\n    let metricName = $(event.target).parents(\".metric-downloader\").data(\"metric\");\n    let csvContent = \"data:text/csv;charset=utf-8,\";\n\n    csvContent += \"key,value\\r\\n\";\n    metricsData[metricName].forEach((metricData)  => {\n      csvContent += `${metricData.key},${metricData.value}\\r\\n`;\n    });\n\n    // Required for FF\n    let link = document.createElement(\"a\");\n    link.setAttribute(\"href\", encodeURI(csvContent));\n    link.setAttribute(\"download\", `${metricName}_metric_data.csv`);\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }\n\n  $(\".metric-chart:visible\").each((_index, container) => {\n    metricsContainer[$(container).data(\"metric\")] = container;\n  });\n  $(\".metric-downloader\").each((_index, container) => {\n    container.onclick = downloadMetricData;\n  });\n\n  if (!$.isEmptyObject(metricsContainer)) {\n    parameterize(Object.keys(metricsContainer))\n    fetch().then((response) => {\n      if (response.data) {\n        $.each(response.data.metrics, (_index, metricData) => {\n          let container = metricsContainer[metricData.name];\n          if (metricData.history.length === 0) {\n            $(container).remove();\n            return;\n          }\n          let info = $(container).data(\"info\");\n          metricsData[metricData.name] = $.extend(true, [], metricData.history);\n          areachart({\n            container: `#${container.id}`,\n            data: metricData.history,\n            title: info.title,\n            objectName: info.object,\n            ...$(container).data()\n          });\n        });\n      } else if (response.errors) {\n        console.log(\"Something wrong happened when fetching metrics:\");\n        $.each(response.errors, (_index, error) => {\n          console.log(error.message);\n        });\n        $(\"#metrics\").remove();\n      }\n    }).fail((err) => {\n      console.log(`Something wrong happened when fetching metrics: ${err.statusText}`);\n      $(\"#metrics\").remove();\n    });\n  }\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}