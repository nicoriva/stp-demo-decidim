{"ast":null,"code":"var currentAllocationZero = function currentAllocationZero() {\n  var $budgetSummary = $(\".budget-summary__progressbox\");\n  return parseInt($budgetSummary.attr(\"data-current-allocation\"), 10) === 0;\n};\nvar isSafeUrl = function isSafeUrl(exitUrl) {\n  if (!exitUrl) {\n    return false;\n  }\n  var safeUrls = [$(\".budget-summary\").attr(\"data-safe-url\").split(\"?\")[0], \"\".concat(location.pathname, \"#\"), \"\".concat(location.href, \"#\"), \"#\"];\n  var safe = false;\n  safeUrls.forEach(function (url) {\n    if (exitUrl.startsWith(url)) {\n      safe = true;\n    }\n  });\n  return safe;\n};\nvar allowExitFrom = function allowExitFrom($el) {\n  if (currentAllocationZero()) {\n    return true;\n  } else if ($el.attr(\"target\") === \"_blank\") {\n    return true;\n  } else if ($el.parents(\"#loginModal\").length > 0) {\n    return true;\n  } else if ($el.parents(\"#authorizationModal\").length > 0) {\n    return true;\n  } else if ($el.attr(\"id\") === \"exit-notification-link\") {\n    return true;\n  } else if ($el.parents(\".voting-wrapper\").length > 0) {\n    return true;\n  } else if (isSafeUrl($el.attr(\"href\"))) {\n    return true;\n  }\n  return false;\n};\n$(function () {\n  var $exitNotification = $(\"#exit-notification\");\n  var $exitLink = $(\"#exit-notification-link\");\n  var defaultExitUrl = $exitLink.attr(\"href\");\n  var defaultExitLinkText = $exitLink.text();\n  var exitLinkText = defaultExitLinkText;\n  if ($exitNotification.length < 1) {\n    // Do not apply when not inside the voting pipeline\n    return;\n  }\n  var openExitNotification = function openExitNotification(url) {\n    var method = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    if (method && method !== \"get\") {\n      $exitLink.attr(\"data-method\", method);\n    } else {\n      $exitLink.removeAttr(\"data-method\");\n    }\n    $exitLink.attr(\"href\", url);\n    $exitLink.html(exitLinkText);\n    $exitNotification.foundation(\"open\");\n  };\n  $(document).on(\"click\", \"a\", function (event) {\n    exitLinkText = defaultExitLinkText;\n    var $link = $(event.currentTarget);\n    if (!allowExitFrom($link)) {\n      event.preventDefault();\n      openExitNotification($link.attr(\"href\"), $link.data(\"method\"));\n    }\n  });\n  // Custom handling for the header sign out so that it won't trigger the\n  // logout form submit and so that it changes the exit link text. This does\n  // not trigger the document link click listener because it has the\n  // data-method attribute to trigger a form submit event.\n  $(\".header a.sign-out-link\").on(\"click\", function (event) {\n    event.preventDefault();\n    event.stopPropagation();\n    var $link = $(event.currentTarget);\n    exitLinkText = $link.text();\n    openExitNotification($link.attr(\"href\"), $link.data(\"method\"));\n  });\n  // Custom handling for the exit link which needs to change the exit link\n  // text to the default text as this is not handled by the document click\n  // listener.\n  $(\"a[data-open='exit-notification']\").on(\"click\", function () {\n    exitLinkText = defaultExitLinkText;\n    openExitNotification(defaultExitUrl);\n  });\n});","map":{"version":3,"names":["currentAllocationZero","$budgetSummary","$","parseInt","attr","isSafeUrl","exitUrl","safeUrls","split","concat","location","pathname","href","safe","forEach","url","startsWith","allowExitFrom","$el","parents","length","$exitNotification","$exitLink","defaultExitUrl","defaultExitLinkText","text","exitLinkText","openExitNotification","method","arguments","undefined","removeAttr","html","foundation","document","on","event","$link","currentTarget","preventDefault","data","stopPropagation"],"sources":["/home/nico/.rbenv/versions/3.0.2/lib/ruby/gems/3.0.0/gems/decidim-budgets-0.27.3/app/packs/src/decidim/budgets/exit_handler.js"],"sourcesContent":["const currentAllocationZero = () => {\n  const $budgetSummary = $(\".budget-summary__progressbox\");\n  return parseInt($budgetSummary.attr(\"data-current-allocation\"), 10) === 0;\n}\n\nconst isSafeUrl = (exitUrl) => {\n  if (!exitUrl) {\n    return false\n  }\n\n  const safeUrls = [\n    $(\".budget-summary\").attr(\"data-safe-url\").split(\"?\")[0],\n    `${location.pathname}#`,\n    `${location.href}#`,\n    \"#\"\n  ];\n\n  let safe = false;\n  safeUrls.forEach((url) => {\n    if (exitUrl.startsWith(url)) {\n      safe =  true\n    }\n  });\n\n  return safe;\n}\n\nconst allowExitFrom = ($el) => {\n  if (currentAllocationZero()) {\n    return true\n  } else if ($el.attr(\"target\") === \"_blank\") {\n    return true;\n  } else if ($el.parents(\"#loginModal\").length > 0) {\n    return true;\n  } else if ($el.parents(\"#authorizationModal\").length > 0) {\n    return true;\n  } else if ($el.attr(\"id\") === \"exit-notification-link\") {\n    return true;\n  } else if ($el.parents(\".voting-wrapper\").length > 0) {\n    return true;\n  } else if (isSafeUrl($el.attr(\"href\"))) {\n    return true\n  }\n\n  return false;\n}\n\n$(() => {\n  const $exitNotification = $(\"#exit-notification\");\n  const $exitLink = $(\"#exit-notification-link\");\n  const defaultExitUrl = $exitLink.attr(\"href\");\n  const defaultExitLinkText = $exitLink.text();\n  let exitLinkText = defaultExitLinkText;\n\n  if ($exitNotification.length < 1) {\n    // Do not apply when not inside the voting pipeline\n    return;\n  }\n\n  const openExitNotification = (url, method = null) => {\n    if (method && method !== \"get\") {\n      $exitLink.attr(\"data-method\", method);\n    } else {\n      $exitLink.removeAttr(\"data-method\");\n    }\n\n    $exitLink.attr(\"href\", url);\n    $exitLink.html(exitLinkText);\n    $exitNotification.foundation(\"open\");\n  };\n\n  $(document).on(\"click\", \"a\", (event) => {\n    exitLinkText = defaultExitLinkText;\n\n    const $link = $(event.currentTarget);\n    if (!allowExitFrom($link)) {\n      event.preventDefault();\n      openExitNotification($link.attr(\"href\"), $link.data(\"method\"));\n    }\n  });\n  // Custom handling for the header sign out so that it won't trigger the\n  // logout form submit and so that it changes the exit link text. This does\n  // not trigger the document link click listener because it has the\n  // data-method attribute to trigger a form submit event.\n  $(\".header a.sign-out-link\").on(\"click\", (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    const $link = $(event.currentTarget);\n    exitLinkText = $link.text();\n    openExitNotification($link.attr(\"href\"), $link.data(\"method\"));\n  });\n  // Custom handling for the exit link which needs to change the exit link\n  // text to the default text as this is not handled by the document click\n  // listener.\n  $(\"a[data-open='exit-notification']\").on(\"click\", () => {\n    exitLinkText = defaultExitLinkText;\n    openExitNotification(defaultExitUrl);\n  });\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}